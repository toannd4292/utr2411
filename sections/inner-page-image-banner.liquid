{{ 'section-image-banner.css' | asset_url | stylesheet_tag }}
<style>
    .banner:after{
      content: "";
      position: absolute;
      top: 0;
      z-index: 1;
      opacity: 1;
      width: 100%;
      height: 100%;
  }
  .banner__buttons {
      justify-content: center;
    }
  
  @media screen and (min-width: 750px) {
    
      .banner__box-2 {
        /* max-width: 80rem; */
        padding:4.5rem 1rem !important;
    }
    .custom-banner--small {
      height: 420px !important;
      .rich-text-background-image {
        min-height: 420px;
      }
    }
    .custom-banner--medium {
      height: 570px !important;
      .rich-text-background-image {
        min-height: 570px;
      }
    }
    .custom-banner--large {
      height: 720px !important;
      .rich-text-background-image {
        min-height: 720px;
      }
    }
    .banner:after{background: linear-gradient(180deg, rgba(0, 0, 0, 0.27) 0%, rgba(0, 0, 0, 0.77) 100%) !important;}
  }
  @media screen and (max-width: 749px) {
    .banner__box-2{padding-bottom:0;}
    .banner:after{background: linear-gradient(180deg, rgba(0, 0, 0, 0.2) 0%, rgba(0, 0, 0, 0.89) 100%) !important;}
    .custom-banner--small {
      overflow: hidden;
    }
    .custom-banner--medium {
      overflow: hidden;
    }
    .custom-banner--large {
      overflow: hidden;
    }
    .rich-text-background-image {
      min-height: unset;
      align-items: unset;
    }
    .custom-grid {
      padding: 40px 37px;
    }
    .content-container--full-width-mobile {
      padding: unset;
    }
    .aspect-ratio-16-8 {
      aspect-ratio: unset !important;
    }
    
    .btn-second {
      margin-top:10px;
    }
  }

    .aspect-ratio-16-8 {
    aspect-ratio: 16 / 8;
    }
</style>

<div class="banner custom-banner--{{ section.settings.image_height }} banner--{{ section.settings.image_height }} banner--desktop-transparent  banner--content-align-mobile-center">
 <div class="rich-text-background-image aspect-ratio-16-8"> 
  <div class="custom-height ">   
  <!-- <div class="page-width"> -->
    <div class="grid grid--1-col grid--1-col-tablet grid--1-col-desktop align-items-center justify-content-center custom-grid">
      <div class="banner__content banner__content--top-center page-width banner--content-align-center">
        <div class="banner__box banner__box-2 content-container content-container--full-width-mobile">
          <div class="text-center">
            <!-- <p class="text-uppercase text-white mb-sm-0 mt-0 mb-1 gotham-medium font-sm-12 font-md-14 font-lg-24">
               {{section.settings.tagline}}
              </p> -->

                  {% case section.settings['small-title-size'] %}
          {% when 'p' %}
         <p class="text-uppercase text-white mb-sm-0 mt-0 mb-1 gotham-medium font-sm-12 font-md-14 font-lg-24">{{section.settings.tagline}}</p>
          {% when 'h1' %}
         <h1 class="text-uppercase text-white mb-lg-1 mb-sm-0 mt-0 gotham-medium font-sm-12 text-black small-title-font-large lh-normal">{{section.settings.tagline}}</h1>
          {% when 'h2' %}
         <h2 class="text-uppercase text-white mb-lg-1 mb-sm-0 mt-0 gotham-medium font-sm-12 text-black small-title-font-medium lh-normal">{{section.settings.tagline}}</h2>
          {% when 'h3' %}
         <h3 class="text-uppercase text-white mb-lg-1 mb-sm-0 mt-0 gotham-medium font-sm-12 text-black small-title-font-small lh-normal">{{section.settings.tagline}}</h3>
          {% endcase %}
            
            {% assign headerSize = section.settings['heading-size'] %}
                {% assign subheaderSize = section.settings['sub-heading-size'] %}

              {% if headerSize == 'large' %}
  <h1 class="font-lg-85 section-title-sm font-tungsten text-white mb-0 mt-0 lh-xl-78 text-uppercase">
    {% if section.settings.enable_tm %}
      <span class="tm-text" data-tm="™">{{ section.settings.heading }}</span>
    {% else %}
      {{ section.settings.heading }}
    {% endif %}
  </h1>
{% elsif headerSize == 'medium' %}
  <h2 class="font-size-medium section-title-sm font-tungsten text-white mb-0 mt-0 lh-xl-78 text-uppercase">
    {% if section.settings.enable_tm %}
      <span class="tm-text" data-tm="™">{{ section.settings.heading }}</span>
    {% else %}
      {{ section.settings.heading }}
    {% endif %}
  </h2>
{% elsif headerSize == 'small' %}
  <h3 class="font-size-small section-title-sm font-tungsten text-white mb-0 mt-0 lh-xl-78 text-uppercase">
    {% if section.settings.enable_tm %}
      <span class="tm-text" data-tm="™">{{ section.settings.heading }}</span>
    {% else %}
      {{ section.settings.heading }}
    {% endif %}
  </h3>
{% else %}
  <h1 class="font-lg-85 section-title-sm font-tungsten text-white mb-0 mt-0 lh-xl-78 text-uppercase">
    {% if section.settings.enable_tm %}
      <span class="tm-text" data-tm="™">{{ section.settings.heading }}</span>
    {% else %}
      {{ section.settings.heading }}
    {% endif %}
  </h1>
{% endif %}


                {% if subheaderSize == 'medium' %}
                  <h2 class="lh-xl-78 lh-sm-normal font-lg-85 font-sm-55 mt-sm-n1 text-white font-best-friend text-teal d-block mt-0 mt-sm-n1-1-4 mb-2">
                    {{ section.settings.subheading }}
                  </h2>
                {% elsif subheaderSize == 'small' %}
                  <h3 class="lh-xl-78 font-size-medium lh-sm-normal font-sm-55 mt-sm-n1 text-white font-best-friend text-teal d-block mt-0 mt-sm-n1-1-4 mb-2">
                    {{ section.settings.subheading }}
                  </h3>
                {% else %}
                  <h2 class="lh-xl-78 lh-sm-normal font-lg-85 font-sm-55 mt-sm-n1 text-white font-best-friend text-teal d-block mt-0 mt-sm-n1-1-4 mb-2">
                    {{ section.settings.subheading }}
                  </h2>
                {% endif %}
                <div style="color: #ffffff">
                  <p class="mb-lg-1 mb-sm-0 mt-1 font-sm-14 font-md-14 text-white font-lg-18 lh-sm-19 lh-lg-22 not-login">
                   {{section.settings.description}}
                  </p>
                  {% comment %} <p class="mb-lg-1 mb-sm-0 mt-1 font-sm-14 font-md-14 text-white font-lg-18 lh-sm-19 lh-lg-22 user-login">
                   Take advantage of our best-ever Power Subscription pricing! Tennis Australia members can upgrade to an annual Power Subscription for only A$100.
                  </p> {% endcomment %}
                </div>
            <div class="mt-3 banner__buttons banner__buttons--multiple">
             <a href="{{section.settings.section-button-url}}" class="btn-white-outline btn-hover-black min-w-lg-225 d-inline-block min-w-sm-180 font-sm-12 text-uppercase not-login">{{section.settings.section-button}}</a>
             {% comment %} <a href="http://app.utrsports.net/power-perks" class="btn-white-outline btn-hover-black min-w-lg-225 d-inline-block min-w-sm-180 font-sm-12 text-uppercase user-login">VIEW POWER BENEFITS</a> {% endcomment %}
              <a href="{{section.settings.section-button-url-second}}" class="btn-white-outline btn-hover-black min-w-lg-225 d-inline-block min-w-sm-180 font-sm-12 text-uppercase">{{section.settings.section-button-second}}</a>
            </div>
          </div>
        </div>
      </div>  
    </div>
  </div> 
  <!-- </div>   -->
</div>
</div>  
<style>
 .tm-text::after {
  content: attr(data-tm);
  font-size: 0.4em;
  vertical-align: super;
  margin-left: 2px;
   position: relative;
  top: -4px;
   font-family: 'Tungsten-Medium';
}

 @media(min-width: 750px) {  
  .rich-text-background-image {
    background-image: url("{{section.settings.section-image | image_url}}");
  }
 }
  
  {% if section.settings.image_mobile %}
  @media(max-width: 749px) {
	.rich-text-background-image {
    	background-image: url("{{section.settings.image_mobile | image_url}}");
      }
  }
{%endif%}
    .font-size-medium {
    font-size: 70px;
}
.font-size-small {
    font-size: 55px;
}

  .small-title-font-large {
    font-size: 40px;
  }
  .small-title-font-medium {
    font-size: 30px;
  }
  small-title-font-small {
    font-size: 24px;
  }

  .user-login { 
    display: none; 
  }

  
</style>
<script>
    window.__geoInfoPromise = window.__geoInfoPromise || null;

    window.getGeoInfo = function () {
        if (window.__geoInfoPromise) {
            return window.__geoInfoPromise;
        }

        const cached = localStorage.getItem('geoInfo');
        if (cached) {
            try {
                const parsed = JSON.parse(cached);
                if (parsed && parsed.region_code) {
                    window.__geoInfoPromise = Promise.resolve(parsed);
                    return window.__geoInfoPromise;
                } else {
                    localStorage.removeItem('geoInfo');
                }
            } catch (e) {
                localStorage.removeItem('geoInfo');
            }
        }

        const accessKey = "{{ settings.key_ipstack }}";
        // console.log("Fetching new geoInfo...", accessKey);

        window.__geoInfoPromise = fetch(`https://api.ipstack.com/check?access_key=${accessKey}`)
            .then(response => response.json())
            .then(data => {
                if (data && data.region_code) {
                    localStorage.setItem('geoInfo', JSON.stringify(data));
                    // console.log("Geo info cached:", data);
                    return data;
                } else {
                    throw new Error("Invalid geoInfo: missing region_code");
                }
            })
            .catch(error => {
                // console.error("Error fetching geoInfo:", error);
                localStorage.removeItem('geoInfo');
                window.__geoInfoPromise = null;
                throw error;
            });

        return window.__geoInfoPromise;
    };

    {% assign cleanSectionID = section.id | replace: '-', '' | replace: '_', '' %}
    function section{{ cleanSectionID }}() {
        let countryCode = "{{ section.settings.country_code }}";
        let hideCountry = "{{ section.settings.hide_country_code }}";
        {% comment %}console.log("Section {{ section.id }} – hideCountry:", hideCountry);{% endcomment %}
        {% comment %}console.log("Section {{ section.id }} – countryCode:", countryCode);{% endcomment %}

        let countryCodeArray = countryCode.replace(/,/g, '')
            .split(' ')
            .map(code => code.trim().toUpperCase())
            .filter(code => code);

        let hideCountryArray = hideCountry.replace(/,/g, '')
            .split(' ')
            .map(code => code.trim().toUpperCase())
            .filter(code => code);

        window.getGeoInfo().then(geoInfo => {
            if (!geoInfo || !geoInfo.region_code) return;

            const userCountryCode = geoInfo.region_code.toUpperCase();
            const watchLiveElement = document.getElementById('shopify-section-{{ section.id }}');

            if (watchLiveElement) {
                if (countryCodeArray.length === 0 && hideCountryArray.length === 0) {
                    watchLiveElement.style.display = 'block';
                } else if (countryCodeArray.includes(userCountryCode)) {
                    watchLiveElement.style.display = 'block';
                } else if (hideCountryArray.includes(userCountryCode)) {
                    watchLiveElement.style.display = 'none';
                } else {
                    watchLiveElement.style.display = countryCodeArray.length > 0 ? 'none' : 'block';
                }
            }
        }).catch(err => {
            // console.warn("Could not determine geoInfo. Defaulting to show element.");
            const watchLiveElement = document.getElementById('shopify-section-{{ section.id }}');
            if (watchLiveElement) {
                watchLiveElement.style.display = 'block';
            }
        });
    }

    document.addEventListener("DOMContentLoaded", function () {
        section{{ cleanSectionID }}();
    });

    {% comment %} async function checkUserAuth() {
  try {
    const response = await fetch("https://api.utrsports.net/v1/auth/current", {
      method: "GET",
      credentials: "include",
      headers: { "Accept": "application/json" }
    });

    console.log("HTTP status:", response.status);

    if (response.status === 200) {
      const data = await response.json();
      console.log("Return data:", data);

      if (data?.id) {
        console.log("✅ Logged in user");

        // Ẩn not-login, hiện user-login
        document.querySelectorAll(".not-login").forEach(el => el.style.display = "none");
        document.querySelectorAll(".user-login").forEach(el => el.style.display = "block");
      } else {
        console.log("❌ User not found → not logged in");
      }

    } else if (response.status === 401 || response.status === 403) {
      console.log("❌ Not logged in → show not-login");
    } else {
      console.error("The API returns another error:", response.status, response.statusText);
    }

  } catch (error) {
    console.error("Error when calling API:", error);
  }
}

// Gọi khi load trang
checkUserAuth(); {% endcomment %}
</script>

{% schema %}
  {
    "name": "Inner Page Image Banner",
    "class": "inner-page-image-banner",
    "presets": [
      {
        "name": "Inner Page Image Banner",
        "category": "Inner Page Image Banner"
      }
    ],
    "settings": [
      {
 			"type": "image_picker",
 			"id": "section-image",
 			"label": "Desktop Screen Image"
 	   },
      {
        "type": "image_picker",
        "id": "image_mobile",
        "label" : "Mobile Screen Image"
      },
      {
        "type": "select",
        "id": "image_height",
        "options": [
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "large",
            "label": "Large"
          }
        ],
        "default": "medium",
        "label": "Banner height",
      },
      {
          "type":"text",
          "id":"tagline",
          "label": "Tag Line Title"
      },
      {
    "type": "select",
    "id": "small-title-size",
    "label": "Tag Line Title Size",
    "options": [
      {
        "value": "h1",
        "label": "Large"
      },
      {
        "value": "h2",
        "label": "Medium"
      },
      {
        "value": "h3",
        "label": "Small"
      },
      {
        "value": "p",
        "label": "Normal"
      }
    ],
    "default": "p"
  },
      {
	"type":"text",
	"id":"heading",
	"label": "Heading Title",
        
},
      {
  "type": "checkbox",
  "id": "enable_tm",
  "label": "Enable small ™"
},
        {
          "type": "select",
          "id": "heading-size",
          "label": "Header Size",
          "options": [
              { "value": "large", "label": "Large" },
              { "value": "medium", "label": "Medium" },
              { "value": "small", "label": "Small" }
          ]
      },
     {
	"type":"text",
	"id":"subheading",
	"label": "Sub Title"
},
     {
          "type": "select",
          "id": "sub-heading-size",
          "label": "Sub Header Size",
          "options": [

              { "value": "medium", "label": "Medium" },
              { "value": "small", "label": "Small" }
          ]
      },
     {
	"type":"text",
	"id":"description",
	"label": "Description Title"
},
        {
            "type": "text",
            "id": "section-button",
            "label": "Button Title"
        },
        {
            "type": "url",
            "id": "section-button-url",
            "label": "Button Link"
        },
        {
 			"type": "text",
 			"id": "section-button-second",
 			"label": "Second Button Title "
 		},
		{
			"type": "url",
 			"id": "section-button-url-second",
 			"label": "Button Link"
		},
      {
      "type": "text",
      "id": "country_code",
      "label": "Region/State Code",
      "info": "Regions are separated by (,) For example IA, EN, HN,"
    },
    {
      "type": "text",
      "id": "hide_country_code",
      "label": "Hide Region/State Code",
      "info": "Regions are separated by (,) For example IA, EN, HN,"
    }
  ]
}
{% endschema %}

{% stylesheet %}
{% endstylesheet %}

{% javascript %}
{% endjavascript %}