{{ 'section-image-banner.css' | asset_url | stylesheet_tag }}

<style>
  .split-layout{
  width:100%;
  position:relative;
  display:grid;
  grid-template-columns:1fr 1fr;
  min-height:500px
}
  .split-layout__content {
    max-width: 657px;
    margin-left: 7rem;
}
.split-layout__image-slider{position:relative;overflow:hidden}
.split-layout__image-container{display:flex;transition:transform .5s ease;cursor:grab}
.split-layout__image-container.dragging{transition:none;cursor:grabbing}
.split-layout__image-slide{line-height:0;min-width:100%;position:relative;overflow:hidden;padding-top:95px;padding-left:22px;height:100%;background:linear-gradient(44.98deg,#05A1DC -26.2%,#64C5BC 86.76%)}
.split-layout__image-slide img{width:100%;height:100%;object-fit:cover}
.split-layout__content{display:flex;flex-direction:column;justify-content:center;padding:3rem}
.split-layout__heading{margin-bottom:3rem;color:#333;font-weight:600;font-size:96px;line-height:110%;letter-spacing:-.04em}
.split-layout__text{font-size:1.1rem;line-height:1.6;margin-bottom:2rem;color:#666}
.split-layout__btn{    font-size: 14px;
    line-height: 40px;
    padding: 6px 0px;
    font-family: "Inter-Medium";
    margin: 0px;
    min-width: 160px;}
.split-layout__button:hover{background:#333}
.split-layout__controls{position:absolute;bottom:30px;left:50px;display:flex;gap:8px;z-index:10}
.split-layout__dot{width:4px;height:4px;border-radius:1px;background:#D9D9D9;cursor:pointer;transition:all .3s ease;display:block!important}
.split-layout__dot.active{background:#fff;width:23px;height:4px}
.split-layout__nav{display:none;position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.5);color:#fff;border:none;width:50px;height:50px;cursor:pointer;font-size:18px;transition:background .3s ease;z-index:10}
.split-layout__nav:hover{background:rgba(0,0,0,.8)}
.split-layout__nav--prev{left:20px}
.split-layout__nav--next{right:20px}
.split-layout__image-container.no-transition{transition:none!important}
.split-layout__image-slide img{width:100%;height:100%;object-fit:cover;pointer-events:none;user-select:none}
@media (max-width:1107px){ .split-layout__heading{font-size:56px}}
  @media (max-width:768px){
  .split-layout__image-slide{padding-top:63px;padding-left:11px}
  .split-layout{grid-template-columns:1fr;grid-template-rows:auto auto}
  .split-layout__content{padding:2rem}
  .split-layout__heading{font-size:36px}
  .split-layout__controls{        left: 13%;
        transform: translateX(-40%);
        bottom: 20px;}
  .split-layout__button{font-size:14px;padding:10px 20px}
    .split-layout__content {
    max-width: 657px;
    margin-left: 0rem;
}
}

  
</style>

<section id="section-{{ section.id }}" class="split-layout-section">
  <div class="split-layout" id="SplitLayout-{{ section.id }}">
    <!-- Image Slider Side -->
    <div class="split-layout__image-slider">
      <div class="split-layout__image-container" id="ImageSlider-{{ section.id }}">
        {%- for block in section.blocks -%}
          <div class="split-layout__image-slide" data-slide="{{ forloop.index0 }}"
               {%- if block.settings.gradient_color_1 != blank and block.settings.gradient_color_2 != blank -%}
                 style="background: linear-gradient({{ block.settings.gradient_angle | default: 45 }}deg, {{ block.settings.gradient_color_1 }}, {{ block.settings.gradient_color_2 }});"
               {%- endif -%}>
            {%- if block.settings.image -%}
              {{ block.settings.image | image_url: width: 1200 | image_tag: loading: 'lazy' }}
            {%- else -%}
              {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-svg' }}
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>

      {%- if section.blocks.size > 1 -%}
        <button class="split-layout__nav split-layout__nav--prev split-prev-{{ section.id }}" type="button" aria-label="Previous">‹</button>
        <button class="split-layout__nav split-layout__nav--next split-next-{{ section.id }}" type="button" aria-label="Next">›</button>
        
        <div class="split-layout__controls">
          {%- for block in section.blocks -%}
            <div class="split-layout__dot{% if forloop.first %} active{% endif %} split-dot-{{ section.id }}" 
                 data-slide="{{ forloop.index0 }}"></div>
          {%- endfor -%}
        </div>
      {%- endif -%}
    </div>

    <!-- Fixed Content Side -->
    <div class="split-layout__content">
      {%- if section.settings.heading != blank -%}
        <h2 class="split-layout__heading inter-semibold">{{ section.settings.heading }}</h2>
      {%- endif -%}

      {%- if section.settings.text != blank -%}
        <div class="split-layout__text">{{ section.settings.text }}</div>
      {%- endif -%}

      {%- if section.settings.button_label != blank or section.settings.button_label_2 != blank -%}
        <div class="split-layout__buttons banner__buttons">
          {%- if section.settings.button_label != blank -%}
            <div class="antr--button">
              <a href="{{ section.settings.button_link | default: '#' }}" class="split-layout__btn button button--secondary">
                {{ section.settings.button_label }}
              </a>
            </div>
          {%- endif -%}

          {%- if section.settings.button_label_2 != blank -%}
            <div class="antr--button">
              <a href="{{ section.settings.button_link_2 | default: '#' }}" class="split-layout__btn button button--secondary">
                {{ section.settings.button_label_2 }}
              </a>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}
    </div>
  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function(){
  // Image Slider Class
  function ImageSlider(sectionId) {
    this.sectionId = sectionId;
    this.slider = document.getElementById('SplitLayout-' + sectionId);
    this.container = document.getElementById('ImageSlider-' + sectionId);
    this.slides = this.container.querySelectorAll('.split-layout__image-slide');
    this.dots = this.slider.querySelectorAll('.split-dot-' + sectionId);
    this.prevBtn = this.slider.querySelector('.split-prev-' + sectionId);
    this.nextBtn = this.slider.querySelector('.split-next-' + sectionId);
    
    this.currentSlide = 0;
    this.totalSlides = {{ section.blocks.size }};
    this.isAnimating = false;
    this.autoRotateInterval = null;
    
    // Drag functionality
    this.isDragging = false;
    this.startPos = 0;
    this.currentTranslate = 0;
    this.prevTranslate = 0;
    
    this.init();
  }
  
  ImageSlider.prototype.init = function() {
    var self = this;
    
    // Navigation buttons
    if (this.prevBtn) {
      this.prevBtn.addEventListener('click', function() {
        self.prevSlide();
      });
    }
    
    if (this.nextBtn) {
      this.nextBtn.addEventListener('click', function() {
        self.nextSlide();
      });
    }
    
    // Dots navigation
    this.dots.forEach(function(dot, index) {
      dot.addEventListener('click', function() {
        self.goToSlide(index);
      });
    });
    
    // Drag functionality
    this.setupDragEvents();
    
    // Auto-rotate
    {%- if section.settings.auto_rotate -%}
    this.startAutoRotate();
    
    // Pause on hover
    this.slider.addEventListener('mouseenter', function() {
      self.stopAutoRotate();
    });
    
    this.slider.addEventListener('mouseleave', function() {
      self.startAutoRotate();
    });
    {%- endif -%}
  };
  
  ImageSlider.prototype.setupDragEvents = function() {
    var self = this;
    
    // Touch events
    this.container.addEventListener('touchstart', function(e) {
      self.touchStart(e);
    });
    
    this.container.addEventListener('touchend', function(e) {
      self.touchEnd(e);
    });
    
    this.container.addEventListener('touchmove', function(e) {
      self.touchMove(e);
    });
    
    // Mouse events
    this.container.addEventListener('mousedown', function(e) {
      e.preventDefault();
      self.touchStart(e);
    });
    
    this.container.addEventListener('mouseup', function(e) {
      self.touchEnd(e);
    });
    
    this.container.addEventListener('mouseleave', function(e) {
      self.touchEnd(e);
    });
    
    this.container.addEventListener('mousemove', function(e) {
      self.touchMove(e);
    });
    
    // Prevent context menu and image drag
    this.container.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });
    
    this.container.addEventListener('dragstart', function(e) {
      e.preventDefault();
    });
  };
  
  ImageSlider.prototype.getPositionX = function(event) {
    return event.type.includes('mouse') ? event.clientX : event.touches[0].clientX;
  };
  
  ImageSlider.prototype.touchStart = function(event) {
    this.isDragging = true;
    this.startPos = this.getPositionX(event);
    this.container.classList.add('no-transition');
    this.container.classList.add('dragging');
    this.stopAutoRotate();
    event.preventDefault();
  };
  
  ImageSlider.prototype.touchMove = function(event) {
    if (!this.isDragging) return;
    
    event.preventDefault();
    var currentPosition = this.getPositionX(event);
    this.currentTranslate = this.prevTranslate + currentPosition - this.startPos;
    
    // Apply the transform immediately for smooth dragging
    this.container.style.transform = 'translateX(' + this.currentTranslate + 'px)';
  };
  
  ImageSlider.prototype.touchEnd = function() {
    if (!this.isDragging) return;
    
    this.isDragging = false;
    this.container.classList.remove('no-transition');
    this.container.classList.remove('dragging');
    
    var movedBy = this.currentTranslate - this.prevTranslate;
    var threshold = this.container.offsetWidth * 0.15; // Reduce threshold to 15%
    
    if (Math.abs(movedBy) > threshold) {
      if (movedBy < 0 && this.currentSlide < this.totalSlides - 1) {
        this.nextSlide();
      } else if (movedBy > 0 && this.currentSlide > 0) {
        this.prevSlide();
      } else {
        // Snap back to current slide if can't move
        this.updateSlider();
      }
    } else {
      // Snap back to current slide
      this.updateSlider();
    }
    
    {%- if section.settings.auto_rotate -%}
    var self = this;
    setTimeout(function() {
      self.startAutoRotate();
    }, 1000);
    {%- endif -%}
  };
  
  ImageSlider.prototype.updateSlider = function() {
    if (this.isAnimating) return;
    
    var self = this;
    this.isAnimating = true;
    
    this.container.style.transform = 'translateX(-' + (this.currentSlide * 100) + '%)';
    this.prevTranslate = -this.currentSlide * this.container.offsetWidth;
    this.currentTranslate = this.prevTranslate;
    
    // Update dots
    this.dots.forEach(function(dot, index) {
      if (index === self.currentSlide) {
        dot.classList.add('active');
      } else {
        dot.classList.remove('active');
      }
    });
    
    setTimeout(function() {
      self.isAnimating = false;
    }, 500);
  };
  
  ImageSlider.prototype.nextSlide = function() {
    if (this.isAnimating) return;
    this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
    this.updateSlider();
  };
  
  ImageSlider.prototype.prevSlide = function() {
    if (this.isAnimating) return;
    this.currentSlide = (this.currentSlide - 1 + this.totalSlides) % this.totalSlides;
    this.updateSlider();
  };
  
  ImageSlider.prototype.goToSlide = function(slideIndex) {
    if (this.isAnimating || slideIndex === this.currentSlide) return;
    this.currentSlide = slideIndex;
    this.updateSlider();
  };
  
  ImageSlider.prototype.startAutoRotate = function() {
    {%- if section.settings.auto_rotate -%}
    var self = this;
    this.stopAutoRotate();
    this.autoRotateInterval = setInterval(function() {
      self.nextSlide();
    }, {{ section.settings.speed | default: 5000 }});
    {%- endif -%}
  };
  
  ImageSlider.prototype.stopAutoRotate = function() {
    if (this.autoRotateInterval) {
      clearInterval(this.autoRotateInterval);
      this.autoRotateInterval = null;
    }
  };
  
  // Initialize slider for this section
  if (document.getElementById('SplitLayout-{{ section.id }}')) {
    new ImageSlider('{{ section.id }}');
  }
});
</script>

{% schema %}
{
  "name": "Split Layout",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Your heading here"
    },
    {
      "type": "textarea",
      "id": "text",
      "label": "Text",
      "default": "Add your description text here"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button link"
    },
    {
      "type": "text",
      "id": "button_label_2",
      "label": "Button label 2"
    },
    {
      "type": "url",
      "id": "button_link_2",
      "label": "Button link 2"
    },
    {
      "type": "checkbox",
      "id": "auto_rotate",
      "label": "Auto rotate slides",
      "default": false
    },
    {
      "type": "range",
      "id": "speed",
      "min": 3000,
      "max": 9000,
      "step": 1000,
      "unit": "ms",
      "label": "Slide speed",
      "default": 5000
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Image Slide",
      "limit": 5,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "color",
          "id": "gradient_color_1",
          "label": "Background Gradient Color 1",
          "default": "#05A1DC"
        },
        {
          "type": "color",
          "id": "gradient_color_2",
          "label": "Background Gradient Color 2",
          "default": "#64C5BC"
        },
        {
          "type": "range",
          "id": "gradient_angle",
          "min": 0,
          "max": 360,
          "step": 15,
          "unit": "deg",
          "label": "Gradient Angle",
          "default": 45
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Split Layout",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}